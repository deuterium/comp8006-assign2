#User Config

#Enter the IP address of the internal address to be used
intAddr=
#Enter the name of the network device to be used internally
intDev=
#Enter the IP address of the external address that is being used
extAddr=
#Enter the name of the network device to be used externally
extDev=
#List TCP ports to allow, comma seperated
tcpPorts=
#List UDP ports to allow, comma seperated
udpPorts=
#List ICP ports to allow, comma seperated
icmpPorts=

#implementation_DO_NOT_TOUCH_BELOW

#disable network manager
systemctl networkmanager.Service disable
#enable forwarding
echo 1 > /proc/sys/net/ipv4/ip_forward

#clear previous rules and chains
iptables -F
iptables --flush
iptables -X

#set default polcies on the firewall to drop all incoming, outgoing and forwarding traffic
iptables -P INPUT DROP
iptables -P FORWARD DROP
iptables -P OUTPUT DROP

#Accepting forwarding between interface devices
iptables -A FORWARD -i $extDev -o $intDev -j ACCEPT
iptables -A FORWARD -i $intDev -o $extDev -j ACCEPT

#Accept user configured ports 
iptables -t nat -A PREROUTING -p tcp -i $extDev -m multiport --dport $tcpPorts[*] -j DNAT --to $intDev
iptables -t nat -A PREROUTING -p udp -i $extDev -m multiport --dport $udpPorts[*] -j DNAT --to $intDev
iptables -t nat -A PREROUTING -p icmp -i $extDev -m multiport --dport $icmpPorts[*] -j DNAT --to $intDev

iptables -t nat -A POSTROUTING -o $extDev -j MASQUERADE



iptables -L
