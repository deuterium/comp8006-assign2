#user config



#implementation_DO_NOT_TOUCH_BELOW




iptables -F
iptables --flush
iptables -X

#set default polcies on the firewall to drop all incoming, outgoing and forwarding traffic
iptables -P INPUT DROP
iptables -P FORWARD DROP
iptables -P OUTPUT DROP

#allow DNS traffic
iptables -A INPUT -p udp --sport 53 -j ACCEPT
iptables -A OUTPUT -p udp --dport 53 -j ACCEPT

#allow DHCP traffic
iptables -A INPUT -p udp --sport 67:68 --dport 67:68 -j ACCEPT
iptables -A OUTPUT -p udp --dport 67:68 --sport 67:68 -j ACCEPT


#allow www over 80 and 443 (SSL) em1
iptables -A INPUT -p tcp --dport 80 -m state --state NEW,ESTABLISHED -j ACCEPT
iptables -A OUTPUT -p tcp --sport 80 -m state --state ESTABLISHED -j ACCEPT

iptables -A INPUT -p tcp --sport 80 -m state --state ESTABLISHED -j ACCEPT
iptables -A OUTPUT -p tcp --dport 80 -m state --state NEW,ESTABLISHED -j ACCEPT

iptables -A INPUT -p tcp --dport 443 -m state --state NEW,ESTABLISHED -j ACCEPT
iptables -A OUTPUT -p tcp --sport 443 -m state --state ESTABLISHED -j ACCEPT

iptables -A INPUT -p tcp --sport 443 -m state --state ESTABLISHED -j ACCEPT
iptables -A OUTPUT -p tcp --dport 443 -m state --state NEW,ESTABLISHED -j ACCEPT

echo 1 > /proc/sys/net/ipv4/ip_forward

iptables -A FORWARD -s 192.168.0.0/24 -d 192.168.1.0/24 -j ACCEPT
iptables -A FORWARD -s 192.168.1.0/24 -d 192.168.0.0/24 -j ACCEPT
#iptables -t nat -A PREROUTING -p tcp --dport 80 -j DNAT --to 192.168.1.2:80
#iptables -A FORWARD -p icmp -s 192.168.1.2 -j ACCEPT

#iptables -A FORWARD -p icmp -s 192.168.1.2 -j ACCEPT

#iptables -A FORWARD -i em1 -j ACCEPT
#iptables -A FORWARD -o p3p1 -j ACCEPT

iptables -A INPUT -p icmp -s 192.168.1.2  -j ACCEPT
iptables -A OUTPUT -p icmp -d 192.168.1.2 -j ACCEPT
iptables -t nat -A PREROUTING -p icmp -d 192.168.0.12 -j DNAT --to 192.168.1.2


#iptables -A INPUT -p icmp -j ACCEPT
#iptables -A OUTPUT -p icmp -j ACCEPT

iptables -L
